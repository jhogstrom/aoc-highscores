<!doctype html>
<html>
  <head>
    <title>LEICA GEO 2020</title>
    <script type="text/javascript" src="./scores.template_files/w3.js.download"></script>
    <script type="text/javascript" src="./scores.template_files/loader.js.download"></script>
    <script type="text/javascript" src="./scores.template_files/jquery.min.js.download"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./scores.template_files/w3.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"/>
    // <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-grid.css">
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-theme-alpine.css">
    <script type="text/javascript" src="./aoc.js"></script>
    <script type="text/javascript" src="./tabledata.js"></script>
<script>
  var charts = {
    "Leaderboard": {
      buttonText: "Leaderboard",
      header: "Leaderboard/Local score (pos)",
      desc: `Initially sorted by position in the list.
            The number for each problem show the player's position after completing the problem.
            Medals are awarded to the fastest players.
            Blank cells indicate the player did not yet solve that particular challenge.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_accumulated_position,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      }
    },
    "PositionChart": {
      isChart: true,
      buttonText: "Position Chart",
      data: accumulated_positions,
      opts: {vAxis: { logScale: 'False', title: 'XXDaily Position' }}
    },
    "LeaderboardScore": {
      buttonText: "Leaderboard (score)",
      header: "Leaderboard/Local score (accumulated score)",
      desc: `Initially sorted by position in the list.
            The number for each problem show the player's total score after completing the problem.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_accumulated_score,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      }
    },
    "Time": {
      buttonText: "Time",
      header: "Time to complete problem after release",
      desc: `Initially sorted by position in the list.
            The time it took for the players to complete the problem after its release.
            Format is &lt;days&gt;.hours:minutes:seconds.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_time_to_complete,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars_time,
      }
    },
    "Offset": {
      buttonText: "Offset",
      header: "Offset from winning player",
      desc: `Initially sorted by position in the list.
            Table shows how long after the fastest player the rest completed the challenge.
            Format is &lt;days&gt;.hours:minutes:seconds.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_offset_from_winner,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars_time,
      }
    },
    "Accumulatedtime": {
      buttonText: "Accumulated time",
      header: "Accumulated time to solve",
      desc: `Yadayada`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_accumulated_solve_time,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars_time,
      }
    },
    "Timestar2": {
      buttonText: "Time star2",
      header: "Time to complete second problem",
      desc: `Initially sorted by position in the list.
            Table shows how long time it took to solve the second problem efter completing the first.
            Format is &lt;days&gt;.hours:minutes:seconds.
            Medals are awarded to the players with the shortest time between star 1 and star 2.`,
      opts: {
        columnDefs: one_star_coldefs,
        rowData: d_second_star,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_one_stars_time,
      }
    },
    "scoreDiff": {
      buttonText: "Score diff",
      header: "Points behind the leader",
      desc: `Initially sorted by position in the list.
            Table shows how far behind the leader players are.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_score_diff,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      }
    },
    "Score diff Chart": {
      isChart: true,
      buttonText: "Score diff Chart",
      data: scorediffgraph,
      opts: {vAxis: { logScale: 'True', title: 'Points behind the leader' }}
    },
    "globalScore": {
      buttonText: "Global score",
      header: "Global score",
      desc: `Initially sorted by position in the list.
            Table shows how many global scores were achieved on a daily basis.
            Medals are awarded to the fastest players.
            <br>
            <span id="global_result">
            `,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_globalscore,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      },
      configFunction: (datakey, config) => {
        const data = config[datakey].opts.rowData

        const playersWithGlobalScore = []
        for (var i = 0; i < data.length; i++) {
          let keys = Object.keys(data[i]);
          for (var j = 5; j < keys.length; j++) {
            key = keys[j]
            if (data[i][key] > 0) {
              console.log(data[i].name);
              playersWithGlobalScore.push(data[i].name.split(".")[1] + "(" + key + ")");
            };
          }
        }
        el = document.querySelector("#global_result");
        if (!el) return;
        if (playersWithGlobalScore.length == 0)
        {
          el.innerHTML = "<br>Maybe tomorrow someone will be in the global top 100... Good luck :)";
        }
        else
        {
          el.innerHTML = "<br>Congratulations " + playersWithGlobalScore.join() + "!";
        }
      }
    },
    "dailyPosition": {
      buttonText: "Daily position",
      header: "Daily position",
      desc: `Initially sorted by position in the list.
            Table shows the position each player achieved per problem.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_daily_position,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      }
    },
    "Daily position Chart": {
      isChart: true,
      buttonText: "Daily position Chart",
      data: daily_position_graph,
      opts: {vAxis: { logScale: 'False', title: 'Position' }}
    },
    "tobiiScore": {
      buttonText: "Tobii Score",
      header: "Tobii score",
      desc: `Initially sorted by position in the list.
            ...tobii score explanation.
            Medals are awarded to the fastest players.`,
      opts: {
        columnDefs: two_star_coldefs,
        rowData: d_tobiiscore,
        domLayout: 'autoHeight',
        defaultColDef: default_coldefs_two_stars,
      }
    },
  }

</script>
</head>
<body>
  <div class="w3-container">
    <div id="tabmenu" class="w3-bar w3-black">
      <!--
        This part should be parametrized or removed
        * Parametrize leaderboard name
        * Use a better way to remove nulls - filter data client side for instance
        <div>
        Leaderboard for LEICA GEO 2020, inactive players removed (<a href="https://lillfiluren.se/tobii/aoc/leaderboard_34481_2020_0.html">add them</a>)
      </div> -->
    </div>
  </div>

  <div id="tables"/>
</body>
</html>